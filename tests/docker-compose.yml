version: '3'

# networks:
#   scheduler:
#     driver: bridge

services:
  pytest_redis:
    image: 'docker.io/bitnami/redis:6.0-debian-10'
    environment:
      # ALLOW_EMPTY_PASSWORD is recommended only for development.
      - ALLOW_EMPTY_PASSWORD=yes
      - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
    ports:
      - '1000:6379'
    expose:
      - "6379"
    volumes:
      - 'redis_data:/bitnami/redis/data'
    container_name: pytest_redis
    # networks:
    #   - scheduler
  pytest_grizly_notebook:
    image: grizly_notebook:latest
    environment:
      - GRIZLY_REDIS_HOST=pytest_redis
    build:
      context: .
      args:
        docker_user: $USERNAME
    ports:
      - "1001:8888"
    volumes:
      - C:\Users\te393828\acoe_projects\platform\local\docker_home:/home/analyst
    container_name: pytest_grizly_notebook
    restart: "always"
    # networks:
    #   - scheduler
  pytest_rq-workers:
    image: rq-workers
    build:
      context: .
      dockerfile: rq-workers/Dockerfile
    links:
      - pytest_redis
    depends_on:
        - pytest_redis
    # networks:
    #   - scheduler
    volumes:
      - ./rq-workers:/usr/src/workers
    container_name: pytest_rq-workers
    restart: "always"
  pytest_rq-dashboard:
    image: rq-dashboard
    container_name: pytest_rq-dashboard
    build:
      context: .
      dockerfile: rq-dashboard/Dockerfile
    ports:
      - '9181:9181'
    expose:
      - "9181"
    links:
      - pytest_redis
    depends_on:
      - pytest_redis
    # networks:
    #   - scheduler
    restart: "always"

volumes:
  redis_data:
    driver: local